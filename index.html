<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Detection Test</title>
    <style>
        body { font-family: sans-serif; padding: 50px; background-color: #f4f4f9; }
        .container { max-width: 400px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        button { width: 100%; padding: 10px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #218838; }
        .result-box { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; }
        .human { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .bot { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>

<div class="container">
    <h2>Aadhar Verification</h2>
    <p>Type smoothly to prove you are human.</p>
    
    <input type="text" id="aadhar" placeholder="Enter 12-digit Aadhar" maxlength="12">
    <input type="text" id="otp" placeholder="Enter 6-digit OTP" maxlength="6">
    
    <button id="loginBtn">Verify & Login</button>

    <div id="result" class="result-box"></div>
</div>

<script>
    // ============================================
    // 1. DATA COLLECTION (The "Ears" of the App)
    // ============================================
    let mousePath = [];
    let clickTimestamps = [];
    let keystrokeTimestamps = [];

    // Listener A: Track Mouse Movement
    document.addEventListener('mousemove', (e) => {
        // We push [x, y, time]
        // This creates the array: [[10,20,100], [12,22,115]...]
        mousePath.push([
            e.clientX, 
            e.clientY, 
            Date.now()
        ]);
    });

    // Listener B: Track Clicks (MouseDown and MouseUp)
    document.addEventListener('mousedown', () => clickTimestamps.push(Date.now()));
    document.addEventListener('mouseup', () => clickTimestamps.push(Date.now()));

    // Listener C: Track Typing Speed
    document.addEventListener('keydown', () => keystrokeTimestamps.push(Date.now()));

    // ============================================
    // 2. THE BRIDGE (Sending Data to Python)
    // ============================================
    const btn = document.getElementById('loginBtn');
    const resultBox = document.getElementById('result');

    btn.addEventListener('click', async () => {
        
        resultBox.style.display = 'none'; // Hide previous result
        btn.textContent = "Analyzing..."; // Show loading state

        // A. Package the data exactly how Python expects it
        const payload = {
            mouse_path: mousePath,
            click_timestamps: clickTimestamps,
            keystroke_timestamps: keystrokeTimestamps
        };

        try {
            // B. Send to Python Backend (Flask)
            const response = await fetch('http://127.0.0.1:5000/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            // C. Get the verdict
            const data = await response.json();
            
            // D. Display Result
            resultBox.style.display = 'block';
            resultBox.innerHTML = `
                <strong>Verdict:</strong> ${data.verdict} <br>
                <strong>Confidence:</strong> ${data.confidence_score.toFixed(2)}% <br>
                <small>Efficiency: ${data.features_calculated.efficiency.toFixed(2)}</small>
            `;

            if (data.is_bot) {
                resultBox.className = "result-box bot";
                alert("⛔ ACCESS DENIED: Bot Detected!");
            } else {
                resultBox.className = "result-box human";
                alert("✅ SUCCESS: Welcome, Human!");
            }

        } catch (error) {
            console.error("Error:", error);
            alert("Backend is offline! Make sure app.py is running.");
        }

        btn.textContent = "Verify & Login"; // Reset button
        
        // OPTIONAL: Clear logs after send to keep it clean
        // mousePath = [];
        // clickTimestamps = [];
        // keystrokeTimestamps = [];
    });
</script>

</body>
</html>